<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="color-scheme" content="dark"/>

  <title>Rave3eN — EDM × Gaming × Community</title>
  <meta name="description" content="Rave3eN — Musik • Emotion • Sinn • Tiere. Portal / Bühne / Events / Clips."/>
  <meta property="og:title" content="Rave3eN — EDM × Gaming × Community"/>
  <meta property="og:description" content="Portal / Bühne / Events / Clips — Neon-Bühne für die Community."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://www.rave3en.de/"/>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">

  <script src="https://player.twitch.tv/js/embed/v1.js"></script>

  <style>
    :root{
      --bg:#05060a;
      --ink: rgba(235,240,255,.92);
      --muted: rgba(183,198,255,.82);
      --blue:#00d5ff;
      --purple:#b100ff;
      --shadow: 0 16px 60px rgba(0,0,0,.45);
      --r: 22px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Rajdhani, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 680px at 70% -10%, rgba(177,0,255,.18), transparent 42%),
        radial-gradient(900px 560px at 20% 10%, rgba(0,213,255,.14), transparent 45%),
        radial-gradient(900px 600px at 70% 110%, rgba(0,213,255,.10), transparent 50%),
        var(--bg);
      color: var(--ink);
      overflow-x:hidden;
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ width:min(1200px, calc(100% - 40px)); margin:0 auto; }

    /* Hintergrund: Sigil Room */
    #sigilRoomBg{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
      opacity: .95;
    }
    header, main{ position: relative; z-index: 1; }

    header{
      position:sticky; top:0;
      z-index: 30;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(5,6,10,.88), rgba(5,6,10,.55));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      gap:18px; padding: 14px 0;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-family: Orbitron, sans-serif;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight: 700;
    }
    .sigil{
      width:42px; height:42px;
      border-radius: 16px;
      background:
        radial-gradient(60% 60% at 30% 30%, rgba(0,213,255,.42), transparent 60%),
        radial-gradient(60% 60% at 70% 70%, rgba(177,0,255,.42), transparent 60%),
        rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 0 32px rgba(0,213,255,.12), 0 0 32px rgba(177,0,255,.10);
      position:relative;
      overflow:hidden;
    }
    .sigil::after{
      content:"";
      position:absolute; inset:-60%;
      background: conic-gradient(from 180deg, rgba(0,213,255,.0), rgba(0,213,255,.3), rgba(177,0,255,.3), rgba(0,213,255,.0));
      animation: spin 8s linear infinite;
      opacity:.75;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }
    .sigil.mini{ width:28px; height:28px; border-radius: 12px; box-shadow:none; }

    .navLinks{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
    .pill{
      display:inline-flex; align-items:center; justify-content:center;
      height: 38px;
      padding: 0 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(235,240,255,.88);
      font-family: Orbitron, sans-serif;
      font-size: 11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .pill:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.22);
      box-shadow: 0 0 20px rgba(0,213,255,.10), 0 0 20px rgba(177,0,255,.09);
    }
    .pill.primary{
      border:none;
      background: linear-gradient(90deg, var(--blue), var(--purple));
      color: rgba(0,0,0,.9);
    }

    main{ padding: 26px 0 60px; }

    .hero{
      position:relative;
      border-radius: 28px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(70% 120% at 15% 10%, rgba(0,213,255,.16), transparent 60%),
        radial-gradient(70% 120% at 80% 0%, rgba(177,0,255,.16), transparent 60%),
        rgba(255,255,255,.04);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .heroGrid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 20px;
      padding: 22px;
      align-items: center;
    }
    .kicker{
      font-family: Orbitron, sans-serif;
      font-size: 11px;
      letter-spacing:.28em;
      text-transform:uppercase;
      color: rgba(183,198,255,.78);
    }
    h1{
      margin: 10px 0 10px;
      font-family: Orbitron, sans-serif;
      font-size: clamp(26px, 3.6vw, 44px);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .sub{
      margin: 0;
      color: rgba(183,198,255,.92);
      line-height: 1.7;
      font-size: 17px;
      max-width: 680px;
    }
    .heroRight{
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding: 16px 16px 12px;
    }
    .heroRight h3{
      font-family: Orbitron, sans-serif;
      margin: 0 0 10px;
      font-size: 14px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(235,240,255,.88);
    }
    .heroRight p{ margin: 0 0 12px; color: rgba(183,198,255,.86); line-height:1.7; }
    .ctaRow{ display:flex; gap:10px; flex-wrap:wrap; }

    .ticker{
      margin-top: 14px;
      border-top: 1px solid rgba(255,255,255,.06);
      padding-top: 12px;
      overflow:hidden;
      cursor: grab;
      user-select:none;
    }
    .track{
      display:flex;
      gap: 18px;
      white-space: nowrap;
      will-change: transform;
      font-family: Orbitron, sans-serif;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size: 11px;
      color: rgba(183,198,255,.72);
      opacity:.95;
    }

    section{ padding: 46px 0 0; }
    .sectionHead{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:16px; margin-bottom: 16px;
    }
    .sectionHead h2{
      margin:0;
      font-family: Orbitron, sans-serif;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size: 16px;
    }
    .tools{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }

    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
    }
    .card{
      grid-column: span 4;
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      box-shadow: 0 10px 34px rgba(0,0,0,.35);
      padding: 16px;
      position:relative;
      overflow:hidden;
    }
    .card.big{ grid-column: span 8; }
    .card h3{
      margin: 0 0 10px;
      font-family: Orbitron, sans-serif;
      font-size: 13px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(235,240,255,.88);
    }
    .card p{ margin:0; color: rgba(183,198,255,.86); line-height: 1.7; }

    .reveal{
      opacity:0;
      transform: translateY(12px);
      transition: opacity .45s ease, transform .45s ease;
    }
    .reveal.on{ opacity:1; transform: translateY(0); }

    .stageTop{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }
    .stageLabel{
      display:flex; align-items:center; gap:10px;
      font-family: Orbitron, sans-serif;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size: 12px;
      color: rgba(235,240,255,.86);
    }
    .gem{
      width:10px; height:10px; border-radius: 999px;
      background: linear-gradient(90deg, var(--blue), var(--purple));
      box-shadow: 0 0 18px rgba(0,213,255,.20), 0 0 18px rgba(177,0,255,.18);
    }

    .playerShell{
      position:relative;
      width:100%;
      aspect-ratio: 16/9;
      background: rgba(0,0,0,.26);
      overflow:hidden;
    }
    #twitchFrame{
      position:absolute; inset:0;
      width:100%; height:100%;
    }

    .drawer{
      position:absolute;
      top: 12px;
      right: 12px;
      width: min(420px, calc(100% - 24px));
      height: min(560px, calc(100% - 24px));
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      overflow:hidden;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      transform: translateY(-10px) scale(.98);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .drawer.on{
      opacity:1;
      transform: translateY(0) scale(1);
      pointer-events:auto;
    }
    #twitchChat{ width:100%; height:100%; border:0; }

    .ratio{
      position:relative;
      width:100%;
      aspect-ratio: 16/9;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      box-shadow: 0 16px 60px rgba(0,0,0,.45);
    }

    .statusPill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.26);
      font-family: Orbitron, sans-serif;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size: 11px;
      user-select:none;
      white-space:nowrap;
    }
    .statusPill .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(183,198,255,.55);
      box-shadow: 0 0 10px rgba(183,198,255,.18);
    }
    .statusPill.live{
      border-color: rgba(255,255,255,.26);
      box-shadow: 0 0 26px rgba(0,213,255,.18), 0 0 26px rgba(177,0,255,.16);
    }
    .statusPill.live .dot{
      background: linear-gradient(90deg, var(--blue), var(--purple));
      box-shadow: 0 0 16px rgba(0,213,255,.25), 0 0 18px rgba(177,0,255,.22);
      animation: pulse 1.1s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(0.88); opacity: .72; }
      50%{ transform: scale(1.12); opacity: 1; }
    }

    .trailerTeaser{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      cursor:pointer;
      background:
        radial-gradient(60% 90% at 70% 40%, rgba(177,0,255,.22), transparent 55%),
        radial-gradient(70% 90% at 30% 60%, rgba(0,213,255,.18), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.15));
    }
    .trailerTeaser::before{
      content:"";
      position:absolute;
      inset:0;
      background-image: var(--thumb);
      background-size:cover;
      background-position:center;
      opacity:.32;
      filter:saturate(1.1) contrast(1.05);
    }
    .trailerPlay{
      position:relative;
      width: 88px;
      height: 88px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.28);
      box-shadow: 0 0 28px rgba(0,213,255,.18), 0 0 28px rgba(177,0,255,.14);
      display:grid;
      place-items:center;
      font-family: Orbitron, sans-serif;
      letter-spacing:.08em;
      color: rgba(255,255,255,.92);
      user-select:none;
    }
    .trailerPlay span{ transform: translateX(2px); font-size: 30px; }

    /* Lightbox */
    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(10px);
      z-index: 9998;
    }
    .modal{
      position:fixed; inset:0; margin:auto;
      width: min(980px, calc(100vw - 28px));
      height: min(620px, calc(100vh - 28px));
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.18);
      background:
        radial-gradient(60% 80% at 20% 10%, rgba(0,213,255,.12), transparent 55%),
        radial-gradient(60% 80% at 80% 20%, rgba(177,0,255,.12), transparent 55%),
        rgba(0,0,0,.78);
      box-shadow:
        0 0 60px rgba(0,213,255,.14),
        0 0 60px rgba(177,0,255,.12),
        0 18px 55px rgba(0,0,0,.55);
      z-index: 9999;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .modalHeader{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .modalTitleWrap{ display:flex; align-items:center; gap:12px; }
    .modalClose{
      width: 42px; height: 42px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.9);
      cursor:pointer;
    }
    .modalClose:hover{
      box-shadow: 0 0 18px rgba(0,213,255,.14), 0 0 18px rgba(177,0,255,.12);
    }
    .modalBody{
      padding: 14px;
      flex: 1;
      display:flex;
      min-height: 0;
    }
    .videoWrap{
      position:relative;
      width:100%;
      height:100%;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
    }
    .videoWrap iframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
    }

    footer{
      padding: 26px 0 18px;
      color: rgba(183,198,255,.66);
      text-align:center;
      font-size: 13px;
      border-top: 1px solid rgba(255,255,255,.06);
      margin-top: 54px;
    }

    @media (max-width: 980px){
      .heroGrid{ grid-template-columns: 1fr; }
      .card{ grid-column: span 12; }
      .card.big{ grid-column: span 12; }
      .sectionHead{ align-items:flex-start; }
      .tools{ justify-content:flex-start; }
      .drawer{ right: 10px; top: 10px; }
    }
  </style>
</head>
<body>

<canvas id="sigilRoomBg" aria-hidden="true"></canvas>

<header>
  <div class="wrap">
    <div class="nav">
      <div class="brand">
        <div class="sigil" aria-hidden="true"></div>
        <div>Rave3eN</div>
      </div>

      <div class="navLinks">
        <a class="pill" href="#stage">Bühne</a>
        <a class="pill" href="events.html">Events</a>
        <a class="pill" href="about.html">Über mich</a>
        <a class="pill primary" href="highlight-clips.html">Clips</a>
      </div>
    </div>
  </div>
</header>

<main>
  <section id="portal">
    <div class="wrap">
      <div class="hero reveal">
        <div class="heroGrid">
          <div>
            <div class="kicker">musik • emotion • sinn • tiere</div>
            <h1>Rave3eN</h1>
            <p class="sub">Creator-Portal für Bühne, Events & Clips. Neon-Vibe für die Community – ehrlich, emotional, bisschen bekloppt, aber immer wir.</p>

            <div class="ticker" id="ticker" aria-label="Ticker">
              <div class="track" id="track" aria-hidden="true">
                <span>RAVE3EN</span><span>EDM × GAMING</span><span>COMMUNITY</span><span>ARENA BREAKOUT</span><span>FEEL THE BASS</span>
                <span>EVENTS</span><span>ÜBER MICH</span><span>CLIPS</span><span>NEON</span><span>RAVE ON</span>
                <span>RAVE3EN</span><span>EDM × GAMING</span><span>COMMUNITY</span><span>ARENA BREAKOUT</span><span>FEEL THE BASS</span>
                <span>EVENTS</span><span>ÜBER MICH</span><span>CLIPS</span><span>NEON</span><span>RAVE ON</span>
              </div>
            </div>
          </div>

          <div class="heroRight">
            <h3>Schnellzugänge</h3>
            <p>Direkt rein in die Bühne oder in die Highlights.</p>
            <div class="ctaRow">
              <a class="pill primary" href="#stage">Zur Bühne</a>
              <a class="pill" href="highlight-clips.html">Clips</a>
              <a class="pill" href="events.html">Events</a>
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>

  <section id="stage">
    <div class="wrap">
      <div class="sectionHead">
        <h2>Bühne</h2>
        <div class="statusPill" id="liveStatusPill" aria-live="polite">
          <span class="dot" aria-hidden="true"></span>
          <span id="liveStatusText">Status: Wird geprüft…</span>
        </div>
        <div class="tools">
          <button class="pill primary" id="btnChat" type="button">Chat</button>
          <button class="pill" id="btnMute" type="button">Stumm</button>
          <a class="pill" href="https://www.twitch.tv/Rave3eN" target="_blank" rel="noreferrer">Öffnen</a>
        </div>
      </div>

      <div class="grid">
        <div class="card big reveal" style="padding:0;">
          <div class="stageTop">
            <div class="stageLabel"><span class="gem"></span> Hauptbühne</div>
            <div class="tools">
              <a class="pill" href="highlight-clips.html">Clips</a>
            </div>
          </div>

          <div class="playerShell">
            <div id="twitchFrame"></div>
          </div>

          <div class="drawer" id="chatDrawer">
            <iframe id="twitchChat" title="Twitch-Chat"></iframe>
          </div>
        </div>

        <div class="card reveal">
          <h3>Vibe</h3>
          <p id="vibeText">Wenn Live aus ist, schaltet die Bühne automatisch ins VOD.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="archiv">
    <div class="wrap">
      <div class="sectionHead">
        <h2>Archiv</h2>
        <div class="tools">
          <a class="pill primary" href="highlight-clips.html">Clips</a>
          <a class="pill" href="events.html">Events</a>
        </div>
      </div>

      <div class="grid">
        <div class="card big reveal">
          <h3>Trailer</h3>
          <p style="margin:0 0 12px; color: rgba(183,198,255,.92); line-height:1.7;">Offizieller Trailer – öffnet sich als Lightbox.</p>
          <div class="ratio">
            <div class="trailerTeaser" id="openTrailer" role="button" tabindex="0" aria-label="Trailer ansehen">
              <div class="trailerPlay"><span>▶</span></div>
            </div>
          </div>
        </div>

        <div class="card reveal">
          <h3>Stärkster Moment</h3>
          <p>Ein Clip, der zeigt, warum wir das hier fühlen – nicht nur schauen.</p>
          <div class="tools" style="margin-top:12px;">
            <a class="pill primary" href="highlight-clips.html">Öffnen</a>
          </div>
        </div>

        <div class="card reveal">
          <h3>Spendenstream-Recap</h3>
          <p>Gemeinsam für Tiere. Ergebnis: <strong>1400 €</strong> für T.I.E.R.E e.V.</p>
          <div class="tools" style="margin-top:12px;">
            <a class="pill primary" href="events.html">Zum Recap</a>
          </div>
        </div>

        <div class="card reveal">
          <h3>Fahrplan</h3>
          <p>Events, Clips, Community-Momente – alles im Takt, alles im Flow.</p>
          <div class="tools" style="margin-top:12px;">
            <a class="pill primary" href="events.html">Events</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="links">
    <div class="wrap">
      <div class="sectionHead">
        <h2>Links</h2>
        <div class="tools">
          <a class="pill primary" href="events.html">Events</a>
          <a class="pill" href="about.html">Über mich</a>
          <a class="pill" href="highlight-clips.html">Clips</a>
        </div>
      </div>

      <div class="grid">
        <div class="card reveal">
          <h3>Discord</h3>
          <p>Backstage, Squad, Ankündigungen.</p>
          <div class="tools" style="margin-top:12px;">
            <a class="pill primary" href="https://discord.gg/Vm2ge54c" target="_blank" rel="noreferrer">Beitreten</a>
          </div>
        </div>

        <div class="card reveal">
          <h3>Social</h3>
          <p>Clips & Updates.</p>
          <div class="tools" style="margin-top:12px;">
            <a class="pill" href="https://www.instagram.com/rave3en_/" target="_blank" rel="noreferrer">Instagram</a>
            <a class="pill" href="https://www.youtube.com/@rave3en30" target="_blank" rel="noreferrer">YouTube</a>
          </div>
        </div>

        <div class="card reveal">
          <h3>Unterstützen</h3>
          <p>Wenn du Bock hast, das Projekt zu pushen.</p>
          <div class="tools" style="margin-top:12px;">
            <a class="pill primary" href="https://www.twitch.tv/Rave3eN" target="_blank" rel="noreferrer">Folgen</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>© Rave3eN</footer>
</main>

<!-- Trailer Lightbox -->
<div class="modalOverlay" id="trailerOverlay" hidden></div>
<div class="modal" id="trailerModal" role="dialog" aria-modal="true" aria-labelledby="trailerTitle" hidden>
  <div class="modalHeader">
    <div class="modalTitleWrap">
      <div class="sigil mini" aria-hidden="true"></div>
      <div>
        <div class="kicker" style="letter-spacing:.2em;">TRAILER</div>
        <h2 id="trailerTitle" style="margin:2px 0 0;">Rave3eN</h2>
      </div>
    </div>
    <button class="modalClose" id="closeTrailer" type="button" aria-label="Trailer schließen">✕</button>
  </div>
  <div class="modalBody">
    <div class="videoWrap">
      <iframe
        id="trailerFrame"
        title="Rave3eN Trailer"
        src=""
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        referrerpolicy="strict-origin-when-cross-origin"></iframe>
    </div>
  </div>
</div>

<script>
  const VOD_ID = "2633733485";
  const parentList = ["www.rave3en.de","rave3en.de","rave3en.github.io","localhost"];
  const TWITCH_CHANNEL = "rave3en";
  const TRAILER_YT = "BGzsyhcu29U";

  function setLiveUI(isLive){
    const pill = document.getElementById("liveStatusPill");
    const txt  = document.getElementById("liveStatusText");
    const vibe = document.getElementById("vibeText");

    if(pill) pill.classList.toggle("live", !!isLive);
    if(txt)  txt.textContent = isLive ? "LIVE jetzt" : "OFFLINE (VOD)";
    if(vibe){
      vibe.textContent = isLive
        ? "Wir sind live – Bühne offen. Komm rein und fühl den Bass."
        : "Wenn Live aus ist, schaltet die Bühne automatisch ins VOD.";
    }
  }

  function initTrailerLightbox(){
    const overlay = document.getElementById("trailerOverlay");
    const modal   = document.getElementById("trailerModal");
    const openBtn = document.getElementById("openTrailer");
    const closeBtn= document.getElementById("closeTrailer");
    const frame   = document.getElementById("trailerFrame");
    if(!overlay || !modal || !openBtn || !closeBtn || !frame) return;

    try{
      openBtn.style.setProperty("--thumb", `url('https://i.ytimg.com/vi/${TRAILER_YT}/hqdefault.jpg')`);
    }catch(e){}

    const ytSrc = (autoplay=false) =>
      `https://www.youtube-nocookie.com/embed/${TRAILER_YT}?rel=0&modestbranding=1&autoplay=${autoplay?1:0}`;

    let lastFocus = null;

    function open(){
      lastFocus = document.activeElement;
      overlay.hidden = false;
      modal.hidden = false;
      frame.src = ytSrc(true);
      document.documentElement.style.overflow = "hidden";
      closeBtn.focus();
    }

    function close(){
      overlay.hidden = true;
      modal.hidden = true;
      frame.src = "";
      document.documentElement.style.overflow = "";
      if(lastFocus && typeof lastFocus.focus === "function") lastFocus.focus();
    }

    openBtn.addEventListener("click", open);
    openBtn.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); open(); }});
    closeBtn.addEventListener("click", close);
    overlay.addEventListener("click", close);

    document.addEventListener("keydown", (e)=>{
      if(modal.hidden) return;
      if(e.key === "Escape") close();
    });
  }

  function mountTwitch(){
    if(!window.Twitch) return;

    const player = new Twitch.Player("twitchFrame", {
      width: "100%",
      height: "100%",
      channel: TWITCH_CHANNEL,
      autoplay: true,
      muted: false,
      parent: parentList
    });

    const chat = document.getElementById("twitchChat");
    if(chat){
      const parents = parentList.map(p => `parent=${encodeURIComponent(p)}`).join("&");
      chat.src = `https://www.twitch.tv/embed/${encodeURIComponent("Rave3eN")}/chat?${parents}`;
    }

    player.addEventListener(Twitch.Player.ONLINE, () => {
      setLiveUI(true);
      try { player.setChannel(TWITCH_CHANNEL); } catch(e){}
    });

    player.addEventListener(Twitch.Player.OFFLINE, () => {
      setLiveUI(false);
      try { player.setVideo("v" + VOD_ID); } catch(e){}
    });

    setTimeout(() => {
      setLiveUI(false);
      try { player.setVideo("v" + VOD_ID); } catch(e){}
    }, 6000);

    const btnMute = document.getElementById("btnMute");
    if(btnMute){
      btnMute.addEventListener("click", () => {
        try{
          const m = player.getMuted();
          player.setMuted(!m);
          btnMute.textContent = m ? "Stumm" : "Ton an";
        }catch(e){}
      });
    }
  }

  document.getElementById("btnChat")?.addEventListener("click", () => {
    document.getElementById("chatDrawer")?.classList.toggle("on");
  });

  // Ticker
  (() => {
    const t = document.getElementById("ticker");
    const track = document.getElementById("track");
    if(!t || !track) return;

    let x = 0;
    let vx = 0.16;
    let drag = false;
    let last = 0;
    let startX = 0;
    let baseX = 0;

    function loop(){
      if(!drag){
        x -= vx;
        track.style.transform = `translateX(${x}px)`;
        if(Math.abs(x) > track.scrollWidth/2) x = 0;
      }
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    t.addEventListener("pointerdown", (e) => {
      drag = true;
      startX = e.clientX;
      baseX = x;
      last = e.clientX;
      t.setPointerCapture(e.pointerId);
      t.style.cursor = "grabbing";
    });
    t.addEventListener("pointermove", (e) => {
      if(!drag) return;
      const dx = e.clientX - startX;
      x = baseX + dx;
      vx = (e.clientX - last) * 0.06;
      last = e.clientX;
      track.style.transform = `translateX(${x}px)`;
    });
    t.addEventListener("pointerup", () => {
      drag = false;
      t.style.cursor = "grab";
    });
    t.addEventListener("pointercancel", () => {
      drag = false;
      t.style.cursor = "grab";
    });
  })();

  // Reveal
  function initReveal(){
    const obs = new IntersectionObserver((entries)=>{
      for(const e of entries){
        if(e.isIntersecting) e.target.classList.add("on");
      }
    }, {threshold: .16});
    document.querySelectorAll(".reveal").forEach(el=>obs.observe(el));
  }

  // Sigil Room Background Canvas
  const canvas = document.getElementById("sigilRoomBg");
  const ctx = canvas?.getContext("2d");
  let w=0,h=0, fog=[], motes=[], sigils=[];

  function resize(){
    if(!canvas || !ctx) return;
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    w = Math.floor(window.innerWidth * dpr);
    h = Math.floor(window.innerHeight * dpr);
    canvas.width = w; canvas.height = h;
  }
  function seedFog(){
    const dpr = (window.devicePixelRatio||1);
    fog = Array.from({length: 28}, ()=>({
      x: Math.random()*w,
      y: Math.random()*h,
      r: (Math.random()*0.28+0.12)*Math.max(w,h),
      a: Math.random()*0.08+0.03,
      vx: (Math.random()-.5)*0.08*dpr,
      vy: (Math.random()-.5)*0.08*dpr
    }));
  }
  function seedMotes(){
    const dpr = (window.devicePixelRatio||1);
    motes = Array.from({length: 44}, ()=>({
      x: Math.random()*w,
      y: Math.random()*h,
      r: Math.random()*2.8*dpr+0.8*dpr,
      a: Math.random()*0.6+0.2,
      vx: (Math.random()-.5)*0.36*dpr,
      vy: (Math.random()-.5)*0.36*dpr,
      hue: Math.random() < .5 ? 185 : 285
    }));
  }
  function seedSigils(){
    sigils = Array.from({length: 7}, ()=>({
      x: (Math.random()*0.6+0.2)*w,
      y: (Math.random()*0.6+0.2)*h,
      s: (Math.random()*0.12+0.06)*Math.min(w,h),
      rot: Math.random()*Math.PI*2,
      vr: (Math.random()-.5)*0.004,
      a: Math.random()*0.14+0.06
    }));
  }

  function drawMist(){
    if(!ctx) return;
    ctx.clearRect(0,0,w,h);

    for(const f of fog){
      f.x += f.vx; f.y += f.vy;
      if(f.x < -f.r) f.x = w+f.r;
      if(f.x > w+f.r) f.x = -f.r;
      if(f.y < -f.r) f.y = h+f.r;
      if(f.y > h+f.r) f.y = -f.r;

      const g = ctx.createRadialGradient(f.x,f.y,0,f.x,f.y,f.r);
      g.addColorStop(0, `rgba(0,213,255,${f.a})`);
      g.addColorStop(0.55, `rgba(177,0,255,${f.a*0.65})`);
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
      ctx.fill();
    }

    const v = ctx.createRadialGradient(w*0.5,h*0.5,0,w*0.5,h*0.5,Math.max(w,h)*0.62);
    v.addColorStop(0,"rgba(0,0,0,0)");
    v.addColorStop(1,"rgba(0,0,0,0.44)");
    ctx.fillStyle = v;
    ctx.fillRect(0,0,w,h);
  }

  function drawMotes(){
    if(!ctx) return;
    for(const m of motes){
      m.x += m.vx; m.y += m.vy;
      if(m.x < -10) m.x = w+10;
      if(m.x > w+10) m.x = -10;
      if(m.y < -10) m.y = h+10;
      if(m.y > h+10) m.y = -10;

      ctx.globalAlpha = m.a;
      ctx.fillStyle = m.hue < 200 ? "rgba(0,213,255,.8)" : "rgba(177,0,255,.75)";
      ctx.beginPath();
      ctx.arc(m.x,m.y,m.r,0,Math.PI*2);
      ctx.fill();
      ctx.globalAlpha = 1;
    }
  }

  function drawSigils(t){
    if(!ctx) return;
    const dpr = (window.devicePixelRatio||1);
    ctx.save();
    ctx.lineWidth = 1.3*dpr;

    for(const s of sigils){
      s.rot += s.vr * (t||0);
      ctx.save();
      ctx.translate(s.x,s.y);
      ctx.rotate(s.rot);
      ctx.globalAlpha = s.a;

      ctx.strokeStyle = "rgba(0,213,255,.45)";
      ctx.beginPath();
      ctx.arc(0,0,s.s,0,Math.PI*2);
      ctx.stroke();

      ctx.strokeStyle = "rgba(177,0,255,.40)";
      ctx.beginPath();
      ctx.moveTo(-s.s*0.9,0); ctx.lineTo(s.s*0.9,0);
      ctx.moveTo(0,-s.s*0.9); ctx.lineTo(0,s.s*0.9);
      ctx.stroke();

      ctx.restore();
    }

    ctx.restore();
    ctx.globalAlpha = 1;
  }

  function loop(t){
    drawMist();
    drawMotes();
    drawSigils(t);
    requestAnimationFrame(loop);
  }

  // Boot
  initReveal();
  resize(); seedFog(); seedMotes(); seedSigils();
  initTrailerLightbox();
  mountTwitch();
  requestAnimationFrame(loop);

  window.addEventListener("resize", ()=>{
    resize(); seedFog(); seedMotes(); seedSigils();
  }, {passive:true});
</script>

</body>
</html>
